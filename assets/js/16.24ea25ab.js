(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{578:function(s,t,a){"use strict";a.r(t);var e=a(17),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"rest-framework专栏讲解-二十-filtering"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest-framework专栏讲解-二十-filtering"}},[s._v("#")]),s._v(" Rest-framework专栏讲解(二十)：Filtering")]),s._v(" "),a("p",[s._v("框架的通用列表视图的默认行为是返回模型管理器的整个查询集, 通常你会希望你的 API 限制查询集返回的项目。")]),s._v(" "),a("p",[s._v("筛选 "),a("code",[s._v("GenericAPIView")]),s._v(" 子类的任何视图的查询集的最简单方法是覆盖该 "),a("code",[s._v(".get_queryset()")]),s._v("方法。")]),s._v(" "),a("p",[s._v("通过覆盖此方法, 您可以通过多种不同方式自定义视图返回的查询集。")]),s._v(" "),a("h3",{attrs:{id:"针对当前用户的过滤查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#针对当前用户的过滤查询"}},[s._v("#")]),s._v(" 针对当前用户的过滤查询")]),s._v(" "),a("p",[s._v("您可能希望过滤查询集, 以确保仅返回与发出请求的当前经过身份验证的用户相关的结果。")]),s._v(" "),a("p",[s._v("您可以根据的值进行过滤 "),a("code",[s._v("request.user")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Purchase\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serializers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" PurchaseSerializer\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" generics\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PurchaseList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PurchaseSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        This view should return a list of all the purchases\n        for the currently authenticated user.\n        """')]),s._v("\n        user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Purchase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purchaser"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"根据网址过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根据网址过滤"}},[s._v("#")]),s._v(" 根据网址过滤")]),s._v(" "),a("p",[s._v("另一种过滤方式可能涉及基于 URL 的某些部分限制查询集。")]),s._v(" "),a("p",[s._v("例如如果您的 URL 配置包含这样的条目：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("re_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^purchases/(?P<username>.+)/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PurchaseList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后您可以编写一个视图, 该视图返回按 URL 的用户名部分过滤的购买查询集：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PurchaseList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PurchaseSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        This view should return a list of all the purchases for\n        the user as determined by the username portion of the URL.\n        """')]),s._v("\n        username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Purchase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purchaser__username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"根据查询参数过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根据查询参数过滤"}},[s._v("#")]),s._v(" 根据查询参数过滤")]),s._v(" "),a("p",[s._v("过滤初始查询集的最后一个示例是根据 url 中的查询参数确定初始查询集。")]),s._v(" "),a("p",[s._v("我们可以重写 "),a("code",[s._v(".get_queryset()")]),s._v(" 以处理诸如的 URL "),a("code",[s._v("http://example.com/api/purchases?username=denvercoder9")]),s._v(", 仅 "),a("code",[s._v("username")]),s._v(" 在 URL 中包含参数时才过滤查询集：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PurchaseList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PurchaseSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        Optionally restricts the returned purchases to a given user,\n        by filtering against a `username` query parameter in the URL.\n        """')]),s._v("\n        queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Purchase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" username "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" queryset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purchaser__username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" queryset\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"通用过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用过滤"}},[s._v("#")]),s._v(" 通用过滤")]),s._v(" "),a("p",[s._v("框架不仅可以覆盖默认查询集而且还支持通用过滤后端, 使您可以轻松构建复杂的搜索和过滤器。")]),s._v(" "),a("p",[s._v("通用过滤器还可以将自己显示为可浏览 API 和 admin API 中的 HTML 控件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d0aa73f851b405aa24ede11e0ff808c~tplv-k3u1fbpfcp-watermark.image",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"设置过滤器后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置过滤器后端"}},[s._v("#")]),s._v(" 设置过滤器后端")]),s._v(" "),a("p",[s._v("可以使用该 "),a("code",[s._v("DEFAULT_FILTER_BACKENDS")]),s._v(" 参数全局设置默认过滤器后端, 例如：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEFAULT_FILTER_BACKENDS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_filters.rest_framework.DjangoFilterBackend'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("您还可以使用基于 "),a("code",[s._v("GenericAPIView")]),s._v(" 类的视图的视图或每个视图集设置过滤器后端：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" django_filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rest_framework\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contrib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" User\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serializers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" UserSerializer\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" generics\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UserSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("django_filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DjangoFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"过滤和对象查找"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过滤和对象查找"}},[s._v("#")]),s._v(" 过滤和对象查找")]),s._v(" "),a("p",[s._v("请注意如果为视图配置了过滤器后端, 则该过滤器后端不仅用于过滤列表视图, 还将用于过滤用于返回单个对象的查询集。")]),s._v(" "),a("p",[s._v("例如给定上一个示例以及 "),a("code",[s._v("id=4675")]),s._v(" 的产品, 以下 URL 将返回相应的对象, 或者返回 "),a("code",[s._v("404")]),s._v(" 响应, 具体取决于给定产品实例是否满足过滤条件：")]),s._v(" "),a("div",{staticClass:"language-url line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-url"}},[a("code",[a("span",{pre:!0,attrs:{class:"token scheme"}},[s._v("http"),a("span",{pre:!0,attrs:{class:"token scheme-delimiter"}},[s._v(":")])]),a("span",{pre:!0,attrs:{class:"token authority"}},[a("span",{pre:!0,attrs:{class:"token authority-delimiter"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token host"}},[s._v("example.com")])]),a("span",{pre:!0,attrs:{class:"token path"}},[a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("products"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("4675"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")])]),a("span",{pre:!0,attrs:{class:"token query"}},[a("span",{pre:!0,attrs:{class:"token query-delimiter"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("category")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("clothing")])]),a("span",{pre:!0,attrs:{class:"token pair-delimiter"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("max_price")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("10.00")])])]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"覆盖初始查询集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#覆盖初始查询集"}},[s._v("#")]),s._v(" 覆盖初始查询集")]),s._v(" "),a("p",[s._v("请注意您可以同时使用覆盖 "),a("code",[s._v(".get_queryset()")]),s._v(" 过滤和通用过滤, 一切都会按预期进行, 例如如果 "),a("code",[s._v("Product")]),s._v(" 与 "),a("code",[s._v("User")]),s._v(" 为的多对多关系, 映射字段是 "),a("code",[s._v("purchase")]),s._v(", 则可能需要编写如下视图：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PurchasedProductsList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    Return a list of all the products that the authenticated\n    user has ever purchased, with optional filtering.\n    """')]),s._v("\n    model "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Product\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ProductSerializer\n    filterset_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ProductFilter\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("purchase_set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"djangofilterbackend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#djangofilterbackend"}},[s._v("#")]),s._v(" DjangoFilterBackend")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("django-filter")]),s._v(" 库包含一个 "),a("code",[s._v("DjangoFilterBackend")]),s._v(" 类, 该类支持针对框架的高度可自定义的字段筛选。")]),s._v(" "),a("p",[s._v("要使用 "),a("code",[s._v("DjangoFilterBackend")]),s._v(" 请先安装 "),a("code",[s._v("django-filter")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("python -m pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" django-filter\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后添加 "),a("code",[s._v("'django_filters'")]),s._v(" 到 Django 的 "),a("code",[s._v("INSTALLED_APPS")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("INSTALLED_APPS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_filters'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("现在您应该将过滤器后端添加到您的设置中：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEFAULT_FILTER_BACKENDS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_filters.rest_framework.DjangoFilterBackend'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("或将过滤器后端添加到单个 View 或 ViewSet：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django_filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" DjangoFilterBackend\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DjangoFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("如果只需要简单的基于等式的过滤, 则可以在视图或视图集上设置一个 "),a("code",[s._v("filterset_fields")]),s._v(" 属性并列出要过滤的字段集：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProductList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Product"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ProductSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DjangoFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    filterset_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'category'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'in_stock'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这将自动为给定的字段创建一个 "),a("code",[s._v("FilterSet")]),s._v(" 类并允许您发出如下请求：")]),s._v(" "),a("div",{staticClass:"language-url line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-url"}},[a("code",[a("span",{pre:!0,attrs:{class:"token scheme"}},[s._v("http"),a("span",{pre:!0,attrs:{class:"token scheme-delimiter"}},[s._v(":")])]),a("span",{pre:!0,attrs:{class:"token authority"}},[a("span",{pre:!0,attrs:{class:"token authority-delimiter"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token host"}},[s._v("example.com")])]),a("span",{pre:!0,attrs:{class:"token path"}},[a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("products")]),a("span",{pre:!0,attrs:{class:"token query"}},[a("span",{pre:!0,attrs:{class:"token query-delimiter"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("category")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("clothing")])]),a("span",{pre:!0,attrs:{class:"token pair-delimiter"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("in_stock")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("True")])])]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("对于更高级的过滤要求您可以指定视图应使用的 "),a("code",[s._v("FilterSet")]),s._v(" 类, 您可以在 "),a("a",{attrs:{href:"https://django-filter.readthedocs.io/en/latest/index.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("django-filter")]),a("OutboundLink")],1),s._v(" 文档中阅读有关 "),a("code",[s._v("FilterSet")]),s._v(" 的更多信息, 还建议您阅读有关"),a("a",{attrs:{href:"https://django-filter.readthedocs.io/en/latest/guide/rest_framework.html",target:"_blank",rel:"noopener noreferrer"}},[s._v(" DRF 集成"),a("OutboundLink")],1),s._v("的部分。")]),s._v(" "),a("h3",{attrs:{id:"searchfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#searchfilter"}},[s._v("#")]),s._v(" SearchFilter")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("SearchFilter")]),s._v(" 级支持简单单的查询参数基于搜索和基于该 admin 界面的搜索功能。")]),s._v(" "),a("p",[s._v("使用时可浏览的 API 将包含一个 "),a("code",[s._v("SearchFilter")]),s._v(" 控件：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ae6e308b7344f2da29966a952d26081~tplv-k3u1fbpfcp-watermark.image",alt:"img"}})]),s._v(" "),a("p",[a("code",[s._v("SearchFilter")]),s._v(" 类仅在视图具有 "),a("code",[s._v("search_fields")]),s._v(" 属性集的情况下应用, 该 "),a("code",[s._v("search_fields")]),s._v(" 属性应该是模型上文本类型字段名称的列表, 例如 "),a("code",[s._v("CharField")]),s._v(" 或 "),a("code",[s._v("TextField")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" filters\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UserSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SearchFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    search_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("这将允许客户端通过执行以下查询来过滤列表中的项目：")]),s._v(" "),a("div",{staticClass:"language-url line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-url"}},[a("code",[a("span",{pre:!0,attrs:{class:"token scheme"}},[s._v("http"),a("span",{pre:!0,attrs:{class:"token scheme-delimiter"}},[s._v(":")])]),a("span",{pre:!0,attrs:{class:"token authority"}},[a("span",{pre:!0,attrs:{class:"token authority-delimiter"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token host"}},[s._v("example.com")])]),a("span",{pre:!0,attrs:{class:"token path"}},[a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("users")]),a("span",{pre:!0,attrs:{class:"token query"}},[a("span",{pre:!0,attrs:{class:"token query-delimiter"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("search")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("russell")])])]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("您还可以使用查找 API 双下划线表示法在 "),a("code",[s._v("ForeignKey")]),s._v(" 或 "),a("code",[s._v("ManyToManyField")]),s._v(" 上执行相关查找：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("search_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'profile__profession'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("对于 "),a("code",[s._v("JSONField")]),s._v(" 和 "),a("code",[s._v("HStoreField")]),s._v(" 字段, 您可以使用相同的双下划线符号根据数据结构内的嵌套值进行过滤(就是高级)：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("search_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data__breed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data__owner__other_pets__0__name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("默认情况下搜索将使用不区分大小写的部分匹配, 搜索参数可以包含多个搜索词, 应将其用 "),a("code",[s._v("空格")]),s._v(" 和 "),a("code",[s._v("/")]),s._v(" 或 "),a("code",[s._v("逗号")]),s._v(" 分隔, 如果使用多个搜索词则仅当所有提供的词都匹配时对象才会在列表中返回。")]),s._v(" "),a("p",[s._v("可以通过在 "),a("code",[s._v("search_fields")]),s._v(" 字符前面添加各种字符来限制搜索行为：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("'^'")]),s._v(" 开始搜索")]),s._v(" "),a("li",[a("code",[s._v("'='")]),s._v(" 完全匹配")]),s._v(" "),a("li",[a("code",[s._v("'@'")]),s._v(" 全文搜索(当前仅支持 Django 的 PostgreSQL 后端)")]),s._v(" "),a("li",[a("code",[s._v("'$'")]),s._v(" 正则表达式搜索")])]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("search_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'=username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'=email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("默认情况下搜索参数名为 "),a("code",[s._v("'search'")]),s._v(", 但是此参数可能会被 "),a("code",[s._v("SEARCH_PARAM")]),s._v(" 设置覆盖。")]),s._v(" "),a("p",[s._v("要根据请求内容动态更改搜索字段, 可以对进行 "),a("code",[s._v("SearchFilter")]),s._v(" 子类化并覆盖该 "),a("code",[s._v("get_search_fields()")]),s._v(" 函数, 例如以下子类仅在查询参数 "),a("code",[s._v("title_only")]),s._v(" 在请求中时才搜索 "),a("code",[s._v("title")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" filters\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomSearchFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SearchFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_search_fields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title_only'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CustomSearchFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_search_fields"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("有关更多详细信息请参见"),a("a",{attrs:{href:"https://docs.djangoproject.com/en/stable/ref/contrib/admin/#django.contrib.admin.ModelAdmin.search_fields",target:"_blank",rel:"noopener noreferrer"}},[s._v("Django文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"orderingfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#orderingfilter"}},[s._v("#")]),s._v(" OrderingFilter")]),s._v(" "),a("p",[a("code",[s._v("OrderingFilter")]),s._v(" 类支持查询结果简单的查询参数进行顺序控制。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79aadc20a9e64934b3a29995ce4dcf95~tplv-k3u1fbpfcp-watermark.image",alt:"img"}})]),s._v(" "),a("p",[s._v("默认情况下查询参数名为 "),a("code",[s._v("'ordering'")]),s._v(", 但这可以被 "),a("code",[s._v("ORDERING_PARAM")]),s._v(" 设置覆盖。")]),s._v(" "),a("p",[s._v("例如按用户名排序用户：")]),s._v(" "),a("div",{staticClass:"language-url line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-url"}},[a("code",[a("span",{pre:!0,attrs:{class:"token scheme"}},[s._v("http"),a("span",{pre:!0,attrs:{class:"token scheme-delimiter"}},[s._v(":")])]),a("span",{pre:!0,attrs:{class:"token authority"}},[a("span",{pre:!0,attrs:{class:"token authority-delimiter"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token host"}},[s._v("example.com")])]),a("span",{pre:!0,attrs:{class:"token path"}},[a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("users")]),a("span",{pre:!0,attrs:{class:"token query"}},[a("span",{pre:!0,attrs:{class:"token query-delimiter"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("ordering")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("username")])])]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("客户端还可以通过在字段名称前添加 "),a("code",[s._v("-")]),s._v(" 来指定相反的顺序, 如下所示：")]),s._v(" "),a("div",{staticClass:"language-url line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-url"}},[a("code",[a("span",{pre:!0,attrs:{class:"token scheme"}},[s._v("http"),a("span",{pre:!0,attrs:{class:"token scheme-delimiter"}},[s._v(":")])]),a("span",{pre:!0,attrs:{class:"token authority"}},[a("span",{pre:!0,attrs:{class:"token authority-delimiter"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token host"}},[s._v("example.com")])]),a("span",{pre:!0,attrs:{class:"token path"}},[a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token path-separator"}},[s._v("/")]),s._v("users")]),a("span",{pre:!0,attrs:{class:"token query"}},[a("span",{pre:!0,attrs:{class:"token query-delimiter"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token pair"}},[a("span",{pre:!0,attrs:{class:"token key"}},[s._v("ordering")]),s._v("="),a("span",{pre:!0,attrs:{class:"token value"}},[s._v("-username")])])]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("也可以指定多个顺序：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("users?ordering"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("account"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("username\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("建议您明确指定 API 应在排序过滤器中允许的字段, 您可以通过在视图上设置 "),a("code",[s._v("ordering_fields")]),s._v(" 属性来做到这一点, 如下所示：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UserSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OrderingFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    ordering_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这有助于防止意外的数据泄漏, 例如允许用户针对密码哈希字段或其他敏感数据进行排序。")]),s._v(" "),a("p",[s._v("如果未在视图上指定 "),a("code",[s._v("ordering_fields")]),s._v(" 属性, 则过滤器类将默认为允许用户对 "),a("code",[s._v("serializer_class")]),s._v(" 属性指定的序列化器上的任何可读字段进行过滤。")]),s._v(" "),a("p",[s._v("如果您确信该视图使用的查询集不包含任何敏感数据, 则还可以通过使用 "),a("code",[s._v("__all__")]),s._v(" 值明确指定一个视图应允许对任何模型字段或查询集聚合进行排序。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BookingsListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Booking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BookingSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OrderingFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    ordering_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__all__'")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("如果在视图上设置了 "),a("code",[s._v("ordering")]),s._v(" 属性它将用作默认顺序。")]),s._v(" "),a("p",[s._v("通常您可以通过 "),a("code",[s._v("order_by")]),s._v(" 在初始查询集上进行设置来控制此操作, 但是使用 "),a("code",[s._v("ordering")]),s._v(" 视图上的参数可以指定顺序, 然后将其作为上下文自动传递到呈现的模板, 如果使用列标题对结果进行排序, 则可以自动呈现不同的列标题：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UserSerializer\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OrderingFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    ordering_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    ordering "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("该 "),a("code",[s._v("ordering")]),s._v(" 属性可以是字符串，也可以是字符串列表、字符串元组。")]),s._v(" "),a("h3",{attrs:{id:"自定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义"}},[s._v("#")]),s._v(" 自定义")]),s._v(" "),a("p",[s._v("您还可以提供自己的通用过滤后端或编写供其他开发人员使用的可安装应用。")]),s._v(" "),a("p",[s._v("为此请重写 "),a("code",[s._v("BaseFilterBackend")]),s._v(" 并重写 "),a("code",[s._v(".filter_queryset(self, request, queryset, view)")]),s._v(" 方法, 该方法应返回一个经过过滤的新查询集。")]),s._v(" "),a("p",[s._v("除了允许客户端执行搜索和过滤外, 通用过滤器后端对于限制对任何给定请求或用户应可见的对象也很有用。")]),s._v(" "),a("p",[s._v("例如您可能需要限制用户只能看到他们创建的对象：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IsOwnerFilterBackend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BaseFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    Filter that only allows users to see their own objects.\n    """')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" queryset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" queryset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("owner"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n复制代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("我们可以通过覆盖 "),a("code",[s._v("get_queryset()")]),s._v(" 视图来实现相同的行为, 但是使用过滤器后端可以使您更轻松地将此限制添加到多个视图, 或者将其应用于整个 API。")]),s._v(" "),a("h4",{attrs:{id:"定制过滤界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定制过滤界面"}},[s._v("#")]),s._v(" 定制过滤界面")]),s._v(" "),a("p",[s._v("通用过滤器还可以在可浏览的 API 中提供接口, 为此您应该实现一个 "),a("code",[s._v("to_html()")]),s._v(" 方法, 该方法返回过滤器的呈现的 HTML 表示形式, 此方法应具有以下签名：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("to_html(self, request, queryset, view)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该方法应返回呈现的 HTML 字符串。")]),s._v(" "),a("h4",{attrs:{id:"分页和模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页和模式"}},[s._v("#")]),s._v(" 分页和模式")]),s._v(" "),a("p",[s._v("您还可以通过实现一种 "),a("code",[s._v("get_schema_fields()")]),s._v(" 方法, 使过滤器控件可用于框架提供的模式自动生成, 此方法应具有以下签名：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("get_schema_fields(self, view)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该方法应返回 "),a("code",[s._v("coreapi.Field")]),s._v(" 实例列表。")]),s._v(" "),a("h3",{attrs:{id:"第三方库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三方库"}},[s._v("#")]),s._v(" 第三方库")]),s._v(" "),a("h5",{attrs:{id:"django-rest框架过滤器软件包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django-rest框架过滤器软件包"}},[s._v("#")]),s._v(" Django REST框架过滤器软件包")]),s._v(" "),a("p",[s._v("在 "),a("a",{attrs:{href:"https://github.com/philipn/django-rest-framework-filters",target:"_blank",rel:"noopener noreferrer"}},[s._v("Django 框架过滤器"),a("OutboundLink")],1),s._v("封装与 "),a("code",[s._v("DjangoFilterBackend")]),s._v(" 类一起工作, 并允许您轻松地在跨关系的创建过滤器, 或在指定字段创建多个过滤器查找类型。")]),s._v(" "),a("h5",{attrs:{id:"django-rest框架全字搜索过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django-rest框架全字搜索过滤器"}},[s._v("#")]),s._v(" Django REST框架全字搜索过滤器")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/trollknurr/django-rest-framework-word-search-filter",target:"_blank",rel:"noopener noreferrer"}},[s._v("djangorestframework-word-filter"),a("OutboundLink")],1),s._v("作为 "),a("code",[s._v("filter.SearchFilter")]),s._v(" 替代品, 它将在文本中搜索完整的单词或完全匹配。")]),s._v(" "),a("h5",{attrs:{id:"django-url过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django-url过滤器"}},[s._v("#")]),s._v(" Django URL过滤器")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/miki725/django-url-filter",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("django-url-filter")]),a("OutboundLink")],1),s._v(" 提供了一种通过友好的 url 过滤数据的安全方法, 它的工作原理与 DRF 序列化程序和字段非常相似, 在某种意义上它们可以嵌套, 但它们被称为 "),a("code",[s._v("filtersets")]),s._v("和 "),a("code",[s._v("filters")]),s._v(", 这提供了过滤相关数据的简单方法, 而且这个库也是通用的, 所以它可以用来过滤其他数据源, 而不仅仅是 Django "),a("code",[s._v("QuerySet")]),s._v("。")]),s._v(" "),a("h5",{attrs:{id:"drf-url-filters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#drf-url-filters"}},[s._v("#")]),s._v(" drf-url-filters")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/manjitkumar/drf-url-filters",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("DRF-URL-Filters")]),a("OutboundLink")],1),s._v(" 是一个简单的 Django 应用程序, 它以干净、简单和可配置的方式在 "),a("code",[s._v("drfmodelviewset")]),s._v(" 的 "),a("code",[s._v("Queryset")]),s._v(" 上应用过滤器, 它还支持对传入查询参数的验证, 一个漂亮的 python 包 "),a("code",[s._v("Voluptuous")]),s._v(" 用于对传入的查询参数进行验证, 关于 "),a("code",[s._v("Voluptuous")]),s._v(" 的最好的部分是您可以根据查询参数要求定义自己的验证。")])])}),[],!1,null,null,null);t.default=n.exports}}]);