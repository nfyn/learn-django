<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rest-framework专栏讲解(二十)：Filtering | Django学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Django学习笔记">
    
    <link rel="preload" href="/learn-django/assets/css/0.styles.17caf383.css" as="style"><link rel="preload" href="/learn-django/assets/js/app.63092e11.js" as="script"><link rel="preload" href="/learn-django/assets/js/3.6592c855.js" as="script"><link rel="preload" href="/learn-django/assets/js/1.aec359a3.js" as="script"><link rel="preload" href="/learn-django/assets/js/16.24ea25ab.js" as="script"><link rel="prefetch" href="/learn-django/assets/js/10.67a1d07b.js"><link rel="prefetch" href="/learn-django/assets/js/11.c4457447.js"><link rel="prefetch" href="/learn-django/assets/js/12.e6c2d47a.js"><link rel="prefetch" href="/learn-django/assets/js/13.db70ab5d.js"><link rel="prefetch" href="/learn-django/assets/js/14.22edb0f9.js"><link rel="prefetch" href="/learn-django/assets/js/15.72a0e604.js"><link rel="prefetch" href="/learn-django/assets/js/17.3d049dfc.js"><link rel="prefetch" href="/learn-django/assets/js/18.1852d5fa.js"><link rel="prefetch" href="/learn-django/assets/js/19.61e5a9ef.js"><link rel="prefetch" href="/learn-django/assets/js/20.6932fd35.js"><link rel="prefetch" href="/learn-django/assets/js/21.1e88ceaf.js"><link rel="prefetch" href="/learn-django/assets/js/22.75ce71bd.js"><link rel="prefetch" href="/learn-django/assets/js/23.ae7dc10d.js"><link rel="prefetch" href="/learn-django/assets/js/24.f354fa3b.js"><link rel="prefetch" href="/learn-django/assets/js/25.a29d8676.js"><link rel="prefetch" href="/learn-django/assets/js/26.94b05786.js"><link rel="prefetch" href="/learn-django/assets/js/27.8fbf30fd.js"><link rel="prefetch" href="/learn-django/assets/js/28.e3ca1881.js"><link rel="prefetch" href="/learn-django/assets/js/29.7a06aaa5.js"><link rel="prefetch" href="/learn-django/assets/js/30.ad51687a.js"><link rel="prefetch" href="/learn-django/assets/js/31.0239b78b.js"><link rel="prefetch" href="/learn-django/assets/js/32.98ac9ed8.js"><link rel="prefetch" href="/learn-django/assets/js/33.f919f04f.js"><link rel="prefetch" href="/learn-django/assets/js/34.15c9c974.js"><link rel="prefetch" href="/learn-django/assets/js/35.4dc7aa4b.js"><link rel="prefetch" href="/learn-django/assets/js/36.35585543.js"><link rel="prefetch" href="/learn-django/assets/js/37.5c940c20.js"><link rel="prefetch" href="/learn-django/assets/js/4.8ed5a25a.js"><link rel="prefetch" href="/learn-django/assets/js/5.10d40c00.js"><link rel="prefetch" href="/learn-django/assets/js/6.7b0e1376.js"><link rel="prefetch" href="/learn-django/assets/js/7.259f140a.js"><link rel="prefetch" href="/learn-django/assets/js/8.b358f5e0.js"><link rel="prefetch" href="/learn-django/assets/js/9.c5ad99ae.js">
    <link rel="stylesheet" href="/learn-django/assets/css/0.styles.17caf383.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Django学习文档</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Django学习笔记</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-django/" class="home-link router-link-active"><!----> <span class="site-name">Django学习文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-django/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      南风以南的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nfyn" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>26</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/learn-django/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      南风以南的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nfyn" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>欢迎学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-django/pages/Introduction.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-django/pages/扩展内置User用户模型.html" class="sidebar-link">扩展内置User用户模型</a></li><li><a href="/learn-django/pages/Django中的信号及其用法.html" class="sidebar-link">Django中的信号及其用法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DRF学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-django/drf/Rest-framework专栏讲解(一)：介绍.html" class="sidebar-link">Rest-framework专栏讲解(一)：介绍</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(二)：View.html" class="sidebar-link">Rest-framework专栏讲解(二)：View</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(三)：Generic view.html" class="sidebar-link">Rest-framework专栏讲解(三)：Generic view</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(四)：Status.html" class="sidebar-link">Rest-framework专栏讲解(四)：Status</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(五)：Request.html" class="sidebar-link">Rest-framework专栏讲解(五)：Request</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(六)：Response.html" class="sidebar-link">Rest-framework专栏讲解(六)：Response</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(七)：Router.html" class="sidebar-link">Rest-framework专栏讲解(七)：Router</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(八)：ViewSet.html" class="sidebar-link">Rest-framework专栏讲解(八)：ViewSet</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(九)：Parsers.html" class="sidebar-link">Rest-framework专栏讲解(九)：Parsers</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十)：Renderes.html" class="sidebar-link">Rest-framework专栏讲解(十)：Renderes</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十一)：Serializers(1).html" class="sidebar-link">Rest-framework专栏讲解(十一)：Serializers(1)</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十二)：Serializer(2).html" class="sidebar-link">Rest-framework专栏讲解(十二)：Serializer(2)</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十三)：Serializer Fields.html" class="sidebar-link">Rest-framework专栏讲解(十三)：Serializer Fields</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十四)：Serializer Relations.html" class="sidebar-link">Rest-framework专栏讲解(十四)：Serializer Relations</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十五)：Validators.html" class="sidebar-link">Rest-framework专栏讲解(十五)：Validators</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十六)：Authentication.html" class="sidebar-link">Rest-framework专栏讲解(十六)：Authentication</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十七)：Permissions.html" class="sidebar-link">Rest-framework专栏讲解(十七)：Permissions</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十八)：Caching.html" class="sidebar-link">Rest-framework专栏讲解(十八)：Caching</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(十九)：Throttling.html" class="sidebar-link">Rest-framework专栏讲解(十九)：Throttling</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(二十)：Filtering.html" class="active sidebar-link">Rest-framework专栏讲解(二十)：Filtering</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(二十一)：Content negotiation.html" class="sidebar-link">Rest-framework专栏讲解(二十一)：Content negotiation</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(二十二)：Format suffixes.html" class="sidebar-link">Rest-framework专栏讲解(二十二)：Format suffixes</a></li><li><a href="/learn-django/drf/Rest-framework专栏讲解(二十三)：Returning URLs.html" class="sidebar-link">Rest-framework专栏讲解(二十三)：Returning URLs</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Rest-framework专栏讲解(二十)：Filtering</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="content__default"><h1 id="rest-framework专栏讲解-二十-filtering"><a href="#rest-framework专栏讲解-二十-filtering" class="header-anchor">#</a> Rest-framework专栏讲解(二十)：Filtering</h1> <p>框架的通用列表视图的默认行为是返回模型管理器的整个查询集, 通常你会希望你的 API 限制查询集返回的项目。</p> <p>筛选 <code>GenericAPIView</code> 子类的任何视图的查询集的最简单方法是覆盖该 <code>.get_queryset()</code>方法。</p> <p>通过覆盖此方法, 您可以通过多种不同方式自定义视图返回的查询集。</p> <h3 id="针对当前用户的过滤查询"><a href="#针对当前用户的过滤查询" class="header-anchor">#</a> 针对当前用户的过滤查询</h3> <p>您可能希望过滤查询集, 以确保仅返回与发出请求的当前经过身份验证的用户相关的结果。</p> <p>您可以根据的值进行过滤 <code>request.user</code>：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> myapp<span class="token punctuation">.</span>models <span class="token keyword">import</span> Purchase
<span class="token keyword">from</span> myapp<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> PurchaseSerializer
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics

<span class="token keyword">class</span> <span class="token class-name">PurchaseList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> PurchaseSerializer

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        This view should return a list of all the purchases
        for the currently authenticated user.
        &quot;&quot;&quot;</span>
        user <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        <span class="token keyword">return</span> Purchase<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>purchaser<span class="token operator">=</span>user<span class="token punctuation">)</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="根据网址过滤"><a href="#根据网址过滤" class="header-anchor">#</a> 根据网址过滤</h3> <p>另一种过滤方式可能涉及基于 URL 的某些部分限制查询集。</p> <p>例如如果您的 URL 配置包含这样的条目：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>re_path<span class="token punctuation">(</span><span class="token string">'^purchases/(?P&lt;username&gt;.+)/$'</span><span class="token punctuation">,</span> PurchaseList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后您可以编写一个视图, 该视图返回按 URL 的用户名部分过滤的购买查询集：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PurchaseList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> PurchaseSerializer

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        This view should return a list of all the purchases for
        the user as determined by the username portion of the URL.
        &quot;&quot;&quot;</span>
        username <span class="token operator">=</span> self<span class="token punctuation">.</span>kwargs<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> Purchase<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>purchaser__username<span class="token operator">=</span>username<span class="token punctuation">)</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="根据查询参数过滤"><a href="#根据查询参数过滤" class="header-anchor">#</a> 根据查询参数过滤</h3> <p>过滤初始查询集的最后一个示例是根据 url 中的查询参数确定初始查询集。</p> <p>我们可以重写 <code>.get_queryset()</code> 以处理诸如的 URL <code>http://example.com/api/purchases?username=denvercoder9</code>, 仅 <code>username</code> 在 URL 中包含参数时才过滤查询集：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PurchaseList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> PurchaseSerializer

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Optionally restricts the returned purchases to a given user,
        by filtering against a `username` query parameter in the URL.
        &quot;&quot;&quot;</span>
        queryset <span class="token operator">=</span> Purchase<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        username <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            queryset <span class="token operator">=</span> queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>purchaser__username<span class="token operator">=</span>username<span class="token punctuation">)</span>
        <span class="token keyword">return</span> queryset
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="通用过滤"><a href="#通用过滤" class="header-anchor">#</a> 通用过滤</h3> <p>框架不仅可以覆盖默认查询集而且还支持通用过滤后端, 使您可以轻松构建复杂的搜索和过滤器。</p> <p>通用过滤器还可以将自己显示为可浏览 API 和 admin API 中的 HTML 控件。</p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d0aa73f851b405aa24ede11e0ff808c~tplv-k3u1fbpfcp-watermark.image" alt="img"></p> <h3 id="设置过滤器后端"><a href="#设置过滤器后端" class="header-anchor">#</a> 设置过滤器后端</h3> <p>可以使用该 <code>DEFAULT_FILTER_BACKENDS</code> 参数全局设置默认过滤器后端, 例如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_FILTER_BACKENDS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>您还可以使用基于 <code>GenericAPIView</code> 类的视图的视图或每个视图集设置过滤器后端：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> django_filters<span class="token punctuation">.</span>rest_framework
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token keyword">from</span> myapp<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> UserSerializer
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics

<span class="token keyword">class</span> <span class="token class-name">UserListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>django_filters<span class="token punctuation">.</span>rest_framework<span class="token punctuation">.</span>DjangoFilterBackend<span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="过滤和对象查找"><a href="#过滤和对象查找" class="header-anchor">#</a> 过滤和对象查找</h3> <p>请注意如果为视图配置了过滤器后端, 则该过滤器后端不仅用于过滤列表视图, 还将用于过滤用于返回单个对象的查询集。</p> <p>例如给定上一个示例以及 <code>id=4675</code> 的产品, 以下 URL 将返回相应的对象, 或者返回 <code>404</code> 响应, 具体取决于给定产品实例是否满足过滤条件：</p> <div class="language-url line-numbers-mode"><pre class="language-url"><code><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">example.com</span></span><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>products<span class="token path-separator">/</span>4675<span class="token path-separator">/</span></span><span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">category</span>=<span class="token value">clothing</span></span><span class="token pair-delimiter">&amp;</span><span class="token pair"><span class="token key">max_price</span>=<span class="token value">10.00</span></span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="覆盖初始查询集"><a href="#覆盖初始查询集" class="header-anchor">#</a> 覆盖初始查询集</h3> <p>请注意您可以同时使用覆盖 <code>.get_queryset()</code> 过滤和通用过滤, 一切都会按预期进行, 例如如果 <code>Product</code> 与 <code>User</code> 为的多对多关系, 映射字段是 <code>purchase</code>, 则可能需要编写如下视图：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PurchasedProductsList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Return a list of all the products that the authenticated
    user has ever purchased, with optional filtering.
    &quot;&quot;&quot;</span>
    model <span class="token operator">=</span> Product
    serializer_class <span class="token operator">=</span> ProductSerializer
    filterset_class <span class="token operator">=</span> ProductFilter

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        <span class="token keyword">return</span> user<span class="token punctuation">.</span>purchase_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="djangofilterbackend"><a href="#djangofilterbackend" class="header-anchor">#</a> DjangoFilterBackend</h3> <p>该 <code>django-filter</code> 库包含一个 <code>DjangoFilterBackend</code> 类, 该类支持针对框架的高度可自定义的字段筛选。</p> <p>要使用 <code>DjangoFilterBackend</code> 请先安装 <code>django-filter</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m pip <span class="token function">install</span> django-filter
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后添加 <code>'django_filters'</code> 到 Django 的 <code>INSTALLED_APPS</code>：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'django_filters'</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>现在您应该将过滤器后端添加到您的设置中：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_FILTER_BACKENDS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>或将过滤器后端添加到单个 View 或 ViewSet：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django_filters<span class="token punctuation">.</span>rest_framework <span class="token keyword">import</span> DjangoFilterBackend

<span class="token keyword">class</span> <span class="token class-name">UserListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>DjangoFilterBackend<span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果只需要简单的基于等式的过滤, 则可以在视图或视图集上设置一个 <code>filterset_fields</code> 属性并列出要过滤的字段集：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ProductList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> ProductSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>DjangoFilterBackend<span class="token punctuation">]</span>
    filterset_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'in_stock'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这将自动为给定的字段创建一个 <code>FilterSet</code> 类并允许您发出如下请求：</p> <div class="language-url line-numbers-mode"><pre class="language-url"><code><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">example.com</span></span><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>products</span><span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">category</span>=<span class="token value">clothing</span></span><span class="token pair-delimiter">&amp;</span><span class="token pair"><span class="token key">in_stock</span>=<span class="token value">True</span></span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于更高级的过滤要求您可以指定视图应使用的 <code>FilterSet</code> 类, 您可以在 <a href="https://django-filter.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>django-filter</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档中阅读有关 <code>FilterSet</code> 的更多信息, 还建议您阅读有关<a href="https://django-filter.readthedocs.io/en/latest/guide/rest_framework.html" target="_blank" rel="noopener noreferrer"> DRF 集成<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的部分。</p> <h3 id="searchfilter"><a href="#searchfilter" class="header-anchor">#</a> SearchFilter</h3> <p>该 <code>SearchFilter</code> 级支持简单单的查询参数基于搜索和基于该 admin 界面的搜索功能。</p> <p>使用时可浏览的 API 将包含一个 <code>SearchFilter</code> 控件：</p> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ae6e308b7344f2da29966a952d26081~tplv-k3u1fbpfcp-watermark.image" alt="img"></p> <p><code>SearchFilter</code> 类仅在视图具有 <code>search_fields</code> 属性集的情况下应用, 该 <code>search_fields</code> 属性应该是模型上文本类型字段名称的列表, 例如 <code>CharField</code> 或 <code>TextField</code>：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> filters

<span class="token keyword">class</span> <span class="token class-name">UserListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>filters<span class="token punctuation">.</span>SearchFilter<span class="token punctuation">]</span>
    search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这将允许客户端通过执行以下查询来过滤列表中的项目：</p> <div class="language-url line-numbers-mode"><pre class="language-url"><code><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">example.com</span></span><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>users</span><span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">search</span>=<span class="token value">russell</span></span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>您还可以使用查找 API 双下划线表示法在 <code>ForeignKey</code> 或 <code>ManyToManyField</code> 上执行相关查找：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'profile__profession'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于 <code>JSONField</code> 和 <code>HStoreField</code> 字段, 您可以使用相同的双下划线符号根据数据结构内的嵌套值进行过滤(就是高级)：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'data__breed'</span><span class="token punctuation">,</span> <span class="token string">'data__owner__other_pets__0__name'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>默认情况下搜索将使用不区分大小写的部分匹配, 搜索参数可以包含多个搜索词, 应将其用 <code>空格</code> 和 <code>/</code> 或 <code>逗号</code> 分隔, 如果使用多个搜索词则仅当所有提供的词都匹配时对象才会在列表中返回。</p> <p>可以通过在 <code>search_fields</code> 字符前面添加各种字符来限制搜索行为：</p> <ul><li><code>'^'</code> 开始搜索</li> <li><code>'='</code> 完全匹配</li> <li><code>'@'</code> 全文搜索(当前仅支持 Django 的 PostgreSQL 后端)</li> <li><code>'$'</code> 正则表达式搜索</li></ul> <p>例如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'=username'</span><span class="token punctuation">,</span> <span class="token string">'=email'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>默认情况下搜索参数名为 <code>'search'</code>, 但是此参数可能会被 <code>SEARCH_PARAM</code> 设置覆盖。</p> <p>要根据请求内容动态更改搜索字段, 可以对进行 <code>SearchFilter</code> 子类化并覆盖该 <code>get_search_fields()</code> 函数, 例如以下子类仅在查询参数 <code>title_only</code> 在请求中时才搜索 <code>title</code>：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> filters

<span class="token keyword">class</span> <span class="token class-name">CustomSearchFilter</span><span class="token punctuation">(</span>filters<span class="token punctuation">.</span>SearchFilter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_search_fields</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> view<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title_only'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>CustomSearchFilter<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_search_fields<span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>有关更多详细信息请参见<a href="https://docs.djangoproject.com/en/stable/ref/contrib/admin/#django.contrib.admin.ModelAdmin.search_fields" target="_blank" rel="noopener noreferrer">Django文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="orderingfilter"><a href="#orderingfilter" class="header-anchor">#</a> OrderingFilter</h3> <p><code>OrderingFilter</code> 类支持查询结果简单的查询参数进行顺序控制。</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79aadc20a9e64934b3a29995ce4dcf95~tplv-k3u1fbpfcp-watermark.image" alt="img"></p> <p>默认情况下查询参数名为 <code>'ordering'</code>, 但这可以被 <code>ORDERING_PARAM</code> 设置覆盖。</p> <p>例如按用户名排序用户：</p> <div class="language-url line-numbers-mode"><pre class="language-url"><code><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">example.com</span></span><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>users</span><span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">ordering</span>=<span class="token value">username</span></span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>客户端还可以通过在字段名称前添加 <code>-</code> 来指定相反的顺序, 如下所示：</p> <div class="language-url line-numbers-mode"><pre class="language-url"><code><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">example.com</span></span><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>users</span><span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">ordering</span>=<span class="token value">-username</span></span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>也可以指定多个顺序：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>http<span class="token punctuation">:</span><span class="token operator">//</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>api<span class="token operator">/</span>users?ordering<span class="token operator">=</span>account<span class="token punctuation">,</span>username
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>建议您明确指定 API 应在排序过滤器中允许的字段, 您可以通过在视图上设置 <code>ordering_fields</code> 属性来做到这一点, 如下所示：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>filters<span class="token punctuation">.</span>OrderingFilter<span class="token punctuation">]</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这有助于防止意外的数据泄漏, 例如允许用户针对密码哈希字段或其他敏感数据进行排序。</p> <p>如果未在视图上指定 <code>ordering_fields</code> 属性, 则过滤器类将默认为允许用户对 <code>serializer_class</code> 属性指定的序列化器上的任何可读字段进行过滤。</p> <p>如果您确信该视图使用的查询集不包含任何敏感数据, 则还可以通过使用 <code>__all__</code> 值明确指定一个视图应允许对任何模型字段或查询集聚合进行排序。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookingsListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Booking<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BookingSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>filters<span class="token punctuation">.</span>OrderingFilter<span class="token punctuation">]</span>
    ordering_fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果在视图上设置了 <code>ordering</code> 属性它将用作默认顺序。</p> <p>通常您可以通过 <code>order_by</code> 在初始查询集上进行设置来控制此操作, 但是使用 <code>ordering</code> 视图上的参数可以指定顺序, 然后将其作为上下文自动传递到呈现的模板, 如果使用列标题对结果进行排序, 则可以自动呈现不同的列标题：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>filters<span class="token punctuation">.</span>OrderingFilter<span class="token punctuation">]</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">]</span>
    ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>该 <code>ordering</code> 属性可以是字符串，也可以是字符串列表、字符串元组。</p> <h3 id="自定义"><a href="#自定义" class="header-anchor">#</a> 自定义</h3> <p>您还可以提供自己的通用过滤后端或编写供其他开发人员使用的可安装应用。</p> <p>为此请重写 <code>BaseFilterBackend</code> 并重写 <code>.filter_queryset(self, request, queryset, view)</code> 方法, 该方法应返回一个经过过滤的新查询集。</p> <p>除了允许客户端执行搜索和过滤外, 通用过滤器后端对于限制对任何给定请求或用户应可见的对象也很有用。</p> <p>例如您可能需要限制用户只能看到他们创建的对象：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">IsOwnerFilterBackend</span><span class="token punctuation">(</span>filters<span class="token punctuation">.</span>BaseFilterBackend<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Filter that only allows users to see their own objects.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">filter_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> queryset<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>owner<span class="token operator">=</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以通过覆盖 <code>get_queryset()</code> 视图来实现相同的行为, 但是使用过滤器后端可以使您更轻松地将此限制添加到多个视图, 或者将其应用于整个 API。</p> <h4 id="定制过滤界面"><a href="#定制过滤界面" class="header-anchor">#</a> 定制过滤界面</h4> <p>通用过滤器还可以在可浏览的 API 中提供接口, 为此您应该实现一个 <code>to_html()</code> 方法, 该方法返回过滤器的呈现的 HTML 表示形式, 此方法应具有以下签名：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>to_html(self, request, queryset, view)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该方法应返回呈现的 HTML 字符串。</p> <h4 id="分页和模式"><a href="#分页和模式" class="header-anchor">#</a> 分页和模式</h4> <p>您还可以通过实现一种 <code>get_schema_fields()</code> 方法, 使过滤器控件可用于框架提供的模式自动生成, 此方法应具有以下签名：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>get_schema_fields(self, view)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该方法应返回 <code>coreapi.Field</code> 实例列表。</p> <h3 id="第三方库"><a href="#第三方库" class="header-anchor">#</a> 第三方库</h3> <h5 id="django-rest框架过滤器软件包"><a href="#django-rest框架过滤器软件包" class="header-anchor">#</a> Django REST框架过滤器软件包</h5> <p>在 <a href="https://github.com/philipn/django-rest-framework-filters" target="_blank" rel="noopener noreferrer">Django 框架过滤器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>封装与 <code>DjangoFilterBackend</code> 类一起工作, 并允许您轻松地在跨关系的创建过滤器, 或在指定字段创建多个过滤器查找类型。</p> <h5 id="django-rest框架全字搜索过滤器"><a href="#django-rest框架全字搜索过滤器" class="header-anchor">#</a> Django REST框架全字搜索过滤器</h5> <p><a href="https://github.com/trollknurr/django-rest-framework-word-search-filter" target="_blank" rel="noopener noreferrer">djangorestframework-word-filter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>作为 <code>filter.SearchFilter</code> 替代品, 它将在文本中搜索完整的单词或完全匹配。</p> <h5 id="django-url过滤器"><a href="#django-url过滤器" class="header-anchor">#</a> Django URL过滤器</h5> <p><a href="https://github.com/miki725/django-url-filter" target="_blank" rel="noopener noreferrer"><code>django-url-filter</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供了一种通过友好的 url 过滤数据的安全方法, 它的工作原理与 DRF 序列化程序和字段非常相似, 在某种意义上它们可以嵌套, 但它们被称为 <code>filtersets</code>和 <code>filters</code>, 这提供了过滤相关数据的简单方法, 而且这个库也是通用的, 所以它可以用来过滤其他数据源, 而不仅仅是 Django <code>QuerySet</code>。</p> <h5 id="drf-url-filters"><a href="#drf-url-filters" class="header-anchor">#</a> drf-url-filters</h5> <p><a href="https://github.com/manjitkumar/drf-url-filters" target="_blank" rel="noopener noreferrer"><code>DRF-URL-Filters</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个简单的 Django 应用程序, 它以干净、简单和可配置的方式在 <code>drfmodelviewset</code> 的 <code>Queryset</code> 上应用过滤器, 它还支持对传入查询参数的验证, 一个漂亮的 python 包 <code>Voluptuous</code> 用于对传入的查询参数进行验证, 关于 <code>Voluptuous</code> 的最好的部分是您可以根据查询参数要求定义自己的验证。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/learn-django/drf/Rest-framework专栏讲解(十九)：Throttling.html" class="prev">
            Rest-framework专栏讲解(十九)：Throttling
          </a></span> <span class="next"><a href="/learn-django/drf/Rest-framework专栏讲解(二十一)：Content negotiation.html">
            Rest-framework专栏讲解(二十一)：Content negotiation
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#针对当前用户的过滤查询" class="sidebar-link reco-side-针对当前用户的过滤查询" data-v-cb1513f6>针对当前用户的过滤查询</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#根据网址过滤" class="sidebar-link reco-side-根据网址过滤" data-v-cb1513f6>根据网址过滤</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#根据查询参数过滤" class="sidebar-link reco-side-根据查询参数过滤" data-v-cb1513f6>根据查询参数过滤</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#通用过滤" class="sidebar-link reco-side-通用过滤" data-v-cb1513f6>通用过滤</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#设置过滤器后端" class="sidebar-link reco-side-设置过滤器后端" data-v-cb1513f6>设置过滤器后端</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#过滤和对象查找" class="sidebar-link reco-side-过滤和对象查找" data-v-cb1513f6>过滤和对象查找</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#覆盖初始查询集" class="sidebar-link reco-side-覆盖初始查询集" data-v-cb1513f6>覆盖初始查询集</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#djangofilterbackend" class="sidebar-link reco-side-djangofilterbackend" data-v-cb1513f6>DjangoFilterBackend</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#searchfilter" class="sidebar-link reco-side-searchfilter" data-v-cb1513f6>SearchFilter</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#orderingfilter" class="sidebar-link reco-side-orderingfilter" data-v-cb1513f6>OrderingFilter</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#自定义" class="sidebar-link reco-side-自定义" data-v-cb1513f6>自定义</a></li><li class="level-3" data-v-cb1513f6><a href="/learn-django/drf/Rest-framework%E4%B8%93%E6%A0%8F%E8%AE%B2%E8%A7%A3(%E4%BA%8C%E5%8D%81)%EF%BC%9AFiltering.html#第三方库" class="sidebar-link reco-side-第三方库" data-v-cb1513f6>第三方库</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/learn-django/assets/js/app.63092e11.js" defer></script><script src="/learn-django/assets/js/3.6592c855.js" defer></script><script src="/learn-django/assets/js/1.aec359a3.js" defer></script><script src="/learn-django/assets/js/16.24ea25ab.js" defer></script>
  </body>
</html>
